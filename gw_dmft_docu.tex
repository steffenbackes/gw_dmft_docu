\documentclass[12pt,a4paper]{scrartcl}
\usepackage[utf8]{inputenc}
\usepackage{amsmath}
\usepackage{amssymb}
\usepackage{braket}
\usepackage{amssymb}
\usepackage{graphicx}
\usepackage{float}
\usepackage{wrapfig}
\usepackage{dsfont}
\usepackage{enumitem}
\usepackage{subfig}
\usepackage[top=3cm, left=3cm, right=3cm, bottom=3cm]{geometry}
\usepackage{fancyhdr}
\usepackage{sidecap}
\usepackage{pstricks}
\usepackage{mathrsfs}
\usepackage{listings}
\usepackage[absolute]{textpos}
\numberwithin{equation}{subsection}
%\numberwithin{figure}{section}
%\usepackage[pdfborder=0 0 0]{hyperref}
\usepackage[colorlinks=True, urlcolor=blue]{hyperref}
\pagestyle{fancy}
\fancyhead[C]{}
\fancyhead[L]{}
\fancyfoot[C]{\thepage}
\fancyhead[R]{}

\newcommand{\cng}[1]{{\color{red}#1}}
\newcommand{\sgn}{{\mathrm{sgn}}}
\newcommand{\GF}{Green's function}
\newcommand{\unity}{\mathds{1}}


\begin{document}

\section{GW (oneshot) + DMFT documentation}

This document  provides the prescription of the combination of a GW calculation
for correlated materials with DMFT applied only to a subset of correlated orbitals.
At this level, the GW calculation will be performed only once at the beginning (one-shot)
based on a DFT Hamiltonian $H^{DFT}$,
to obtain a Selfenergy $\Sigma^{GW}$ for all states. 
Based on the new Hamiltonian $H^{GW}$,
DMFT will be used to selfconsistently generate a non-perturbative Selfenergy for a set of correlated
local orbitals, and replaces the local component of the Selfenergy $\Sigma^{GW}$ by $\Sigma^{DMFT}$.

No further selfconsistency will be performed, {\it i.e.} no update of the single-particle
spectra of $H^{GW}$ will be done. By this, the final interacting system will be
described by a {\GF} with the non-interacting DFT dispersion, corrected by
a non-local Selfenergy where the non-local components
correspond to $\Sigma^{GW}=G_0W_0$, while the local components
of the correlated orbitals correspond to $\Sigma^{DMFT}$.

Extensions to a full GW+DMFT selfconsistency will be discussed elsewhere.


\subsection{The GW part}

On the basis of $H^{DFT}$ a $G_0W_0$ calculation has to be performed on the full
system. By this, the Selfenergy in the Kohn-Sham basis is obtained for all states
\begin{align}
 \Sigma_{\nu\nu'}(k,\omega)
 &= \left[ G_0W_0  \right]_{\nu\nu'}(k,\omega).
\end{align}
By this, the GW estimate for the full interacting {\GF} is given by
\begin{align}
 G^{GW}_{\nu\nu'}(k,\omega) 
 &= \left[ \unity(\omega +\mu +i\delta) -H^{DFT}(k)+v^{XC}(k) - \Sigma^{GW}(k,\omega)  \right]^{-1}_{\nu\nu'}.
\end{align}


\subsubsection{Output}
At this point the basis transformation to the local Wannier basis will be
performed on the GW side.
For the next step of the DMFT calculation one needs
on a mesh in k-space in the full Brillouin zone:
\begin{itemize}
\item $\epsilon_m(k)$: The eigenvalues  of $H^{DFT}(k)$ in the Wannier basis
for all relevant orbitals
\item $\mu$: The chemical potential that yields the correct physical number of electrons $N_e$
for $H^{DFT}$
\item $v^{XC}_{mm'}(k)$: The value of the exchange-correlation potential 
in the Wannier basis for all relevant orbitals
\item $\Sigma^{GW}_{mm'}(k,\omega)$: The Selfenergy within GW in the Wannier basis for all relevant orbitals
on real frequencies $\omega$.
\end{itemize}


\subsection{The DMFT part}

Within DMFT we then calculate a local correction $\Sigma^{DMFT}$ for a subset of correlated
Wannier orbitals.

The input of the calculation will be the output of the GW calculation. First, one will usually apply a Wannier-interpolation of the GW data to obtain a fine k-mesh
since the GW output will be given on a very coarse grid.
We then proceed as follows:

\begin{enumerate}

\item Transform the Selfenergy from GW to the imaginary Matsubara axis by
\begin{align}
\Sigma^{GW}_{mm'}(k,i\omega_n)
&= \frac{1}{2\pi i} \int \, \frac{\Sigma^{GW}_{mm'}(k,\omega)}{\omega - i\omega_n}\ \mathrm{d}\omega , \mbox{\hspace{1cm} or}\\
&= \frac{1}{\pi} \int \, \frac{\mathrm{Im}[\Sigma^{GW}_{mm'}(k,\omega)]}{\omega - i\omega_n} \ \mathrm{d}\omega , \mbox{\hspace{0.7cm} or} \\
&= \frac{1}{\pi i} \int \, \frac{\mathrm{Re}[\Sigma^{GW}_{mm'}(k,\omega)]}{\omega - i\omega_n} \ \mathrm{d}\omega .
\end{align}

\item Calculate the local diagonal part of the GW Selfenergy ONLY for the correlated subset of orbitals $f$
\begin{align}
 \Sigma^{GW,loc}_{f}(i\omega_n)
 &= \frac{1}{N_k}\sum_k \Sigma^{GW}_{ff}(k,i\omega_n).
\end{align}


\item (This step can be omitted if the correct physical number of electrons $N_e$ is already known)
 
Construct the initial non-interacting {\GF} on the imaginary Matsubara axis via
\begin{align}
   G_{0,mm'}(k,i\omega_n) 
 &= \left[ \unity(i\omega_n +\mu) -H^{DFT}(k)   \right]^{-1}_{mm''},
\end{align}
 and calculate the total number of electrons
\begin{align}
  N_e
 &= \lim_{\tau\rightarrow 0^-} \frac{1}{\beta N_k} 
                \sum_{i\omega_n}\sum_{k,m}G_{0,mm}(k,i\omega_n) \mathrm{e}^{-i\omega_n\tau}.
\end{align}

\item Make a first guess for the local impurity Selfenergy of the correlated
orbitals $\Sigma^{imp}_{ff}$, for example one can use the GW result
\begin{align}
 \Sigma^{imp}_{ff}(i\omega_n)
 &=  \Sigma^{GW,loc}_{f}(i\omega_n).
\end{align}

\item Set up the interacting {\GF}, where the local component of the GW
Selfenergy for the correlated orbitals $f$ is replaced by $\Sigma^{imp}$
\begin{align}
 G_{mm'}(k,i\omega_n) 
 &= \left[ \unity(i\omega_n+\mu ) -H^{DFT}(k) + v^{XC}(k) \right.\\
          &- \Sigma^{GW}(k,i\omega_n) 
          + \Sigma^{GW,loc}_f(i\omega_n)
          \left. - \Sigma^{imp}(i\omega_n) \right]^{-1}_{mm'}.
\end{align}

\item Calculate the local {\GF} (for all orbitals) then and Weiss field $\mathscr{G}$ ONLY
on the subset of correlated orbitals $f$. Neglecting
offdiagonal components in the hybridization we are also only interested 
in the diagonal components of $\mathscr{G}$
% using the local GW Selfenergy where the diagonal components of the
% correlated orbitals $f$ are replaced by the impurity Selfenergy
\begin{align}
 G^{loc}_{mm'}(i\omega_n) 
 &= \frac{1}{N_k}\sum_k  G_{mm'}(k,i\omega_n) ,\\
%
\Rightarrow \mathscr{G}^{-1}_{ff}(i\omega_n) &= [G^{loc} ]^{-1}_{ff} (i\omega_n)
%                 + \Sigma^{GW,loc}_{ff'}
%                 - \Sigma^{GW,loc}_{ff}
                + \Sigma^{imp}_{ff}(i\omega_n) .
\end{align}
The Weiss field matrix $\mathscr{G}$ is not explicitly needed, so
we do not invert the last equation to obtain $\mathscr{G}$ .

\item Calculate the Hybridization function
\begin{align}
 \Delta_{ff}(i\omega_n)
 &= i\omega_n + \tilde{\mu}_f -  \mathscr{G}^{-1}_{ff}(i\omega_n),
\end{align}
where the local chemical potential $\tilde{\mu}_f$ is given by
\begin{align}
 \tilde{\mu}_f = \lim_{\omega_n\rightarrow \infty} \mathrm{Re}\left[ \mathscr{G}^{-1}_{ff}(i\omega_n) \right]
\end{align}
and transform $\Delta(i\omega_n)$ to the imaginary time axis $\tau$ by a Fourier transform
\begin{align}
 \Delta_{ff}(\tau) &= \frac{1}{\beta} \sum_{i\omega_n} \Delta_{ff}(i\omega_n) \mathrm{e}^{-i\omega_n\tau}
\end{align}
and solve the impurity model for the correlated $f$ orbitals.

\item Obtain the new local Selfenergy $\Sigma^{imp}_{ff}(i\omega_n)$ 
from the impurity model and calculate the updated full {\GF}
\begin{align}
 G_{mm'}(k,i\omega_n) 
 &= \left[ \unity(i\omega_n+\mu ) -H^{DFT}(k) + v^{XC}_{mm'}(k) \right.\\
          &- \Sigma^{GW}(k,i\omega_n) 
          + \Sigma^{GW,loc}_f(i\omega_n)
          \left. - \Sigma^{imp}(i\omega_n) \right]^{-1}_{mm'}.
\end{align}
Adjust the chemical potential $\mu$ in such a way that the number of electrons
$N_e$ is preserved.
Then go back to step 5. Repeat until convergence
is reached.

\end{enumerate}


\subsubsection{Output}
After convergence, {\it e.g.} the local spectral function $A_m(\omega)$
can be obtained by analytic continuation of $ G^{loc}_{mm}(i\omega_n) $.


\end{document}
